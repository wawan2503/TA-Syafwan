{# Simple SVG diagram using computed values as relative proportions #}
{% set wg = results.wg_mm %}
{% set lg = results.lg_mm %}
{% set wp = results.wp_mm %}
{% set lp = results.lp_mm %}
{% set wf = results.wf_mm %}
{% set lf = results.lf_mm %}

{# Normalize into a 520x360 canvas #}
{% set canvas_w = 520 %}
{% set canvas_h = 360 %}
{% set margin = 40 %}

{# scale so ground fits nicely #}
{% set scale_x = (canvas_w - 2*margin) / wg %}
{% set scale_y = (canvas_h - 2*margin) / lg %}
{% set s = scale_x if scale_x < scale_y else scale_y %}

{% set gx = (canvas_w - wg*s) / 2 %}
{% set gy = (canvas_h - lg*s) / 2 %}

{% set px = gx + (wg - wp)*s/2 %}
{% set py = gy + 20 %} {# patch near top #}

{% set feed_x = gx + (wg - wf)*s/2 %}
{% set feed_y = py + lp*s %}
{% set feed_h = (gy + lg*s) - feed_y - 20 %} {# leave bottom padding #}

<svg viewBox="0 0 {{canvas_w}} {{canvas_h}}" class="antenna-svg" role="img" aria-label="Antenna diagram">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="7" refY="3" orient="auto">
      <path d="M0,0 L7,3 L0,6 Z" fill="currentColor"></path>
    </marker>
    <marker id="arrow2" markerWidth="10" markerHeight="10" refX="3" refY="3" orient="auto">
      <path d="M7,0 L0,3 L7,6 Z" fill="currentColor"></path>
    </marker>
  </defs>

  <!-- Ground plane -->
  <rect x="{{gx}}" y="{{gy}}" width="{{wg*s}}" height="{{lg*s}}" class="ground" rx="10" />
  <text x="{{gx + 10}}" y="{{gy + 24}}" class="label">GROUND</text>

  <!-- Patch -->
  <rect x="{{px}}" y="{{py}}" width="{{wp*s}}" height="{{lp*s}}" class="patch" rx="6" />
  <text x="{{px + 10}}" y="{{py + 24}}" class="label">PATCH</text>

  <!-- Feedline -->
  <rect x="{{feed_x}}" y="{{feed_y}}" width="{{wf*s}}" height="{{feed_h}}" class="feed" rx="4" />
  <text x="{{feed_x + wf*s + 8}}" y="{{feed_y + 18}}" class="label">FEED</text>

  <!-- Dimension: WP -->
  <line x1="{{px}}" y1="{{py - 14}}" x2="{{px + wp*s}}" y2="{{py - 14}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{px + (wp*s)/2}}" y="{{py - 20}}" class="dim-text" text-anchor="middle">WP ≈ {{ '%.2f'|format(wp) }} mm</text>

  <!-- Dimension: LP -->
  <line x1="{{px - 14}}" y1="{{py}}" x2="{{px - 14}}" y2="{{py + lp*s}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{px - 18}}" y="{{py + (lp*s)/2}}" class="dim-text" text-anchor="end" dominant-baseline="middle">LP ≈ {{ '%.2f'|format(lp) }} mm</text>

  <!-- Dimension: WG -->
  <line x1="{{gx}}" y1="{{gy + lg*s + 14}}" x2="{{gx + wg*s}}" y2="{{gy + lg*s + 14}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{gx + (wg*s)/2}}" y="{{gy + lg*s + 32}}" class="dim-text" text-anchor="middle">WG ≈ {{ '%.2f'|format(wg) }} mm</text>

  <!-- Dimension: LG -->
  <line x1="{{gx + wg*s + 14}}" y1="{{gy}}" x2="{{gx + wg*s + 14}}" y2="{{gy + lg*s}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{gx + wg*s + 18}}" y="{{gy + (lg*s)/2}}" class="dim-text" dominant-baseline="middle">LG ≈ {{ '%.2f'|format(lg) }} mm</text>

  <!-- Dimension: WF -->
  <line x1="{{feed_x}}" y1="{{feed_y + feed_h + 10}}" x2="{{feed_x + wf*s}}" y2="{{feed_y + feed_h + 10}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{feed_x + (wf*s)/2}}" y="{{feed_y + feed_h + 28}}" class="dim-text" text-anchor="middle">WF ≈ {{ '%.2f'|format(wf) }} mm</text>

  <!-- Dimension: LF (shown as total feed rectangle height on diagram) -->
  <line x1="{{feed_x + wf*s + 18}}" y1="{{feed_y}}" x2="{{feed_x + wf*s + 18}}" y2="{{feed_y + feed_h}}" class="dim" marker-start="url(#arrow2)" marker-end="url(#arrow)" />
  <text x="{{feed_x + wf*s + 22}}" y="{{feed_y + feed_h/2}}" class="dim-text" dominant-baseline="middle">LF ≈ {{ '%.2f'|format(lf) }} mm</text>

</svg>
